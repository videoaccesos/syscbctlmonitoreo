// Video Accesos - Schema mapeado a BD producción: wwwvideo_video_accesos (MySQL 5.7)
// NO ejecutar migrations contra producción. Usar solo: prisma generate / prisma db pull

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

// ============================================================
// SEGURIDAD - Autenticación y Control de Acceso
// ============================================================

model Usuario {
  id                Int      @id @default(autoincrement()) @map("usuario_id")
  usuario           String   @db.VarChar(30)
  contrasena        String   @db.VarChar(10)
  modificarFechas   String   @default("N") @map("modificar_fechas") @db.Char(1)
  ultimaSesion      DateTime @default(now()) @map("ultima_sesion") @db.DateTime(0)
  direccionIp       String   @default("") @map("direccion_ip") @db.VarChar(15)
  cambioContrasena  DateTime? @map("cambio_contrasena") @db.Date
  empleadoId        Int?     @map("empleado_id")
  privadaId         Int?     @map("privada_id")
  logueado          Int      @default(0) @db.TinyInt
  usuarioMovId      Int      @default(0) @map("usuario_mov_id")
  estatusId         Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")

  // Relaciones
  empleado       Empleado?             @relation(fields: [empleadoId], references: [id])
  privada        Privada?              @relation("UsuarioPrivada", fields: [privadaId], references: [id])
  gruposDetalles GrupoUsuarioDetalle[]
  bitacoraInicio BitacoraInicio[]

  @@index([empleadoId])
  @@index([privadaId])
  @@map("usuarios")
}

model GrupoUsuario {
  id                Int      @id @default(autoincrement()) @map("grupo_usuario_id")
  nombre            String   @default("") @db.VarChar(30)
  estatusId         Int      @default(0) @map("estatus_id")
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId      Int      @default(0) @map("usuario_id")

  // Relaciones
  detalles GrupoUsuarioDetalle[]
  permisos PermisoAcceso[]

  @@map("grupos_usuarios")
}

model GrupoUsuarioDetalle {
  grupoUsuarioId Int @map("grupo_usuario_id")
  usuarioId      Int @map("usuario_id")

  grupo   GrupoUsuario @relation(fields: [grupoUsuarioId], references: [id], onDelete: Cascade)
  usuario Usuario      @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@id([grupoUsuarioId, usuarioId])
  @@index([grupoUsuarioId])
  @@index([usuarioId])
  @@map("grupos_usuarios_detalles")
}

model Proceso {
  id                Int      @id @default(autoincrement()) @map("proceso_id")
  nombre            String   @default("") @db.VarChar(50)
  rutaAcceso        String?  @map("ruta_acceso") @db.Text
  procesoPadreId    Int?     @map("proceso_padre_id")
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId      Int      @default(0) @map("usuario_id")

  // Self-referencing para jerarquía de menú
  procesoPadre Proceso?     @relation("ProcesoHijos", fields: [procesoPadreId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  hijos        Proceso[]    @relation("ProcesoHijos")
  subprocesos  Subproceso[]

  @@index([procesoPadreId])
  @@map("procesos")
}

model Subproceso {
  id        Int     @id @default(autoincrement()) @map("subproceso_id")
  procesoId Int     @map("proceso_id")
  nombre    String  @default("") @db.VarChar(50)
  funcion   String? @db.VarChar(50)

  proceso  Proceso         @relation(fields: [procesoId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  permisos PermisoAcceso[]

  @@index([procesoId])
  @@map("subprocesos")
}

model PermisoAcceso {
  grupoUsuarioId Int @map("grupo_usuario_id")
  subprocesoId   Int @map("subproceso_id")

  grupo      GrupoUsuario @relation(fields: [grupoUsuarioId], references: [id], onDelete: Cascade)
  subproceso Subproceso   @relation(fields: [subprocesoId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([grupoUsuarioId, subprocesoId])
  @@index([grupoUsuarioId])
  @@index([subprocesoId])
  @@map("permisos_acceso")
}

model BitacoraInicio {
  usuarioId    Int       @map("usuario_id")
  inicioSesion DateTime  @map("inicio_sesion") @db.DateTime(0)
  cierreSesion DateTime? @map("cierre_sesion") @db.DateTime(0)
  direccionIp  String    @default("") @map("direccion_ip") @db.VarChar(15)
  hostName     String    @default("") @map("host_name") @db.VarChar(255)

  usuario Usuario @relation(fields: [usuarioId], references: [id])

  @@id([usuarioId, inicioSesion])
  @@index([usuarioId])
  @@map("bitacora_inicio")
}

// ============================================================
// CATALOGOS
// ============================================================

model Puesto {
  id                Int      @id @default(autoincrement()) @map("puesto_id")
  descripcion       String   @db.VarChar(50)
  estatusId         Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId      Int      @default(0) @map("usuario_id") @db.TinyInt

  empleados Empleado[]

  @@map("puestos")
}

model Empleado {
  id                            Int      @id @default(autoincrement()) @map("empleado_id")
  nombre                        String   @db.VarChar(50)
  apePaterno                    String   @map("ape_paterno") @db.VarChar(50)
  apeMaterno                    String   @map("ape_materno") @db.VarChar(50)
  nroSeguroSocial               String   @default("") @map("nro_seguro_social") @db.VarChar(50)
  puestoId                      Int      @map("puesto_id")
  nroOperador                   String   @default("") @map("nro_operador") @db.VarChar(4)
  calle                         String   @default("") @db.VarChar(60)
  nroCasa                       String   @default("") @map("nro_casa") @db.VarChar(10)
  sexo                          String   @default("") @db.Char(1)
  colonia                       String   @default("") @db.VarChar(30)
  telefono                      String   @default("") @db.VarChar(14)
  celular                       String   @default("") @db.VarChar(14)
  email                         String   @default("") @db.VarChar(60)
  fechaIngreso                  DateTime? @map("fecha_ingreso") @db.Date
  fechaBaja                     DateTime? @map("fecha_baja") @db.Date
  motivoBaja                    String   @default("") @map("motivo_baja") @db.Text
  googleAuthCode                String   @default("") @map("google_auth_code") @db.VarChar(16)
  permisoAdministrador          Int      @default(0) @map("permiso_administrador")
  permisoEncargadoAdministracion Int     @default(0) @map("permiso_encargado_administracion")
  permisoSupervisor             Int      @default(0) @map("permiso_supervisor")
  estatusId                     Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion             DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId                  Int      @default(0) @map("usuario_id")

  // Relaciones
  puesto           Puesto           @relation(fields: [puestoId], references: [id])
  usuarios         Usuario[]
  registrosAccesos RegistroAcceso[] @relation("AccesoEmpleado")
  ordenesTecnico   OrdenServicio[]  @relation("OrdenTecnico")
  ordenesCierre    OrdenServicio[]  @relation("OrdenCierreTecnico")
  ordenesEmpleado  OrdenServicio[]  @relation("OrdenEmpleado")

  @@index([puestoId])
  @@map("empleados")
}

model Turno {
  id                Int      @id @default(autoincrement()) @map("turno_id")
  descripcion       String   @db.VarChar(50)
  puestoId          Int      @default(0) @map("puesto_id")
  estatusId         Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId      Int      @default(0) @map("usuario_id") @db.TinyInt

  @@map("turnos")
}

model Clasificacion {
  id                Int      @id @default(autoincrement()) @map("clasificacion_id")
  tipoGestionId     Int      @map("tipo_gestion_id") @db.TinyInt
  descripcion       String   @db.VarChar(80)
  estatusId         Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId      Int      @default(0) @map("usuario_id")

  @@map("clasificaciones")
}

model Falla {
  id                Int      @id @default(autoincrement()) @map("falla_id")
  codigo            String   @db.VarChar(5)
  descripcion       String   @db.VarChar(50)
  estatusId         Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId      Int      @default(0) @map("usuario_id") @db.TinyInt

  @@map("fallas")
}

model CodigoServicio {
  id                Int      @id @default(autoincrement()) @map("codigo_servicio_id")
  codigo            String   @db.VarChar(5)
  descripcion       String   @db.VarChar(50)
  estatusId         Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId      Int      @default(0) @map("usuario_id") @db.TinyInt

  ordenesServicio OrdenServicio[]

  @@map("codigos_servicio")
}

model Diagnostico {
  id                Int      @id @default(autoincrement()) @map("diagnostico_id")
  codigo            String   @db.VarChar(5)
  descripcion       String   @db.VarChar(50)
  estatusId         Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId      Int      @default(0) @map("usuario_id") @db.TinyInt

  ordenesServicio OrdenServicio[]

  @@map("diagnosticos")
}

// tipos_gastos: PK real es gasto_id, campos: gasto, tipo_gasto, dia_pago, estatus_id
model TipoGasto {
  id         Int    @id @default(autoincrement()) @map("gasto_id")
  gasto      String @default("") @db.VarChar(100)
  tipoGasto  Int    @default(0) @map("tipo_gasto") @db.TinyInt
  diaPago    String @default("") @map("dia_pago") @db.VarChar(10)
  estatusId  Int    @default(1) @map("estatus_id") @db.TinyInt

  gastos Gasto[]

  @@map("tipos_gastos")
}

model Folio {
  id                Int      @id @default(autoincrement()) @map("folio_id")
  descripcion       String   @default("") @db.VarChar(30)
  prefijo           String   @default("") @db.Char(2)
  consecutivo       Int      @default(0)
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId      Int      @default(0) @map("usuario_id")

  @@map("folios")
}

// ============================================================
// GESTION DE COMUNIDADES
// ============================================================

model Privada {
  id                Int      @id @default(autoincrement()) @map("privada_id")
  descripcion       String   @db.VarChar(80)
  apePaterno        String   @default("") @map("ape_paterno") @db.VarChar(50)
  apeMaterno        String   @default("") @map("ape_materno") @db.VarChar(50)
  nombre            String   @default("") @db.VarChar(50)
  tipoContactoId    Int      @default(0) @map("tipo_contacto_id") @db.TinyInt
  telefono          String   @default("") @db.VarChar(14)
  celular           String   @default("") @db.VarChar(14)
  email             String   @default("") @db.VarChar(60)
  historial         String   @default("") @db.VarChar(60)
  // DNS inline (3 slots con puerto, alias, tipo_tarjeta, contrasena cada uno)
  dns1              String   @default("") @map("dns_1") @db.VarChar(100)
  puerto1           String   @default("") @map("puerto_1") @db.VarChar(10)
  alias1            String   @default("") @map("alias_1") @db.VarChar(100)
  tipoTarjeta1      String   @default("") @map("tipo_tarjeta1") @db.VarChar(30)
  contrasena1       String   @default("") @map("contrasena_1") @db.VarChar(100)
  dns2              String   @default("") @map("dns_2") @db.VarChar(100)
  puerto2           String   @default("") @map("puerto_2") @db.VarChar(10)
  alias2            String   @default("") @map("alias_2") @db.VarChar(100)
  tipoTarjeta2      String   @default("") @map("tipo_tarjeta2") @db.VarChar(30)
  contrasena2       String   @default("") @map("contrasena_2") @db.VarChar(100)
  dns3              String   @default("") @map("dns_3") @db.VarChar(100)
  puerto3           String   @default("") @map("puerto_3") @db.VarChar(10)
  alias3            String   @default("") @map("alias_3") @db.VarChar(100)
  tipoTarjeta3      String   @default("") @map("tipo_tarjeta3") @db.VarChar(30)
  contrasena3       String   @default("") @map("contrasena_3") @db.VarChar(100)
  // Video inline (3 slots con alias cada uno)
  video1            String   @default("") @map("video_1") @db.VarChar(100)
  aliasVideo1       String   @default("") @map("alias_video1") @db.VarChar(100)
  video2            String   @default("") @map("video_2") @db.VarChar(100)
  aliasVideo2       String   @default("") @map("alias_video2") @db.VarChar(100)
  video3            String   @default("") @map("video_3") @db.VarChar(100)
  aliasVideo3       String   @default("") @map("alias_video3") @db.VarChar(100)
  precioVehicular   Int      @default(0) @map("precio_vehicular")
  precioPeatonal    Int      @default(0) @map("precio_peatonal")
  precioMensualidad Int      @default(0) @map("precio_mensualidad")
  venceContrato     DateTime? @map("vence_contrato") @db.Date
  observaciones     String   @default("") @db.Text
  estatusId         Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId      Int      @default(0) @map("usuario_id")

  // Relaciones
  residencias      Residencia[]
  relays           PrivadaRelay[]
  usuarios         Usuario[]         @relation("UsuarioPrivada")
  registrosAccesos RegistroAcceso[]
  ordenesServicio  OrdenServicio[]
  gastos           Gasto[]

  @@map("privadas")
}

// privadas_relays: tabla separada para config detallada de relays
model PrivadaRelay {
  id               Int    @id @default(autoincrement()) @map("relay_id")
  privadaId        Int    @map("privada_id")
  renglon          Int    @default(0)
  concepto         String @default("") @db.VarChar(80)
  relayNumero      String @default("") @map("relay_numero") @db.VarChar(10)
  estatusId        Int    @default(1) @map("estatus_id")
  tiempoActivacion Int    @default(0) @map("tiempo_activacion")

  privada Privada @relation(fields: [privadaId], references: [id], onDelete: Cascade)

  @@index([privadaId])
  @@map("privadas_relays")
}

model Residencia {
  id                   Int      @id @default(autoincrement()) @map("residencia_id")
  privadaId            Int      @map("privada_id")
  nroCasa              String   @default("") @map("nro_casa") @db.VarChar(10)
  calle                String   @default("") @db.VarChar(60)
  telefono1            String   @default("") @db.VarChar(14)
  telefono2            String   @default("") @db.VarChar(14)
  interfon             String   @default("") @db.VarChar(20)
  telefonoInterfon     String   @default("") @map("telefono_interfon") @db.VarChar(14)
  observaciones        String   @default("") @db.Text
  estatusId            Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion    DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId         Int      @default(0) @map("usuario_id")

  // Relaciones
  privada          Privada           @relation(fields: [privadaId], references: [id])
  residentes       Residente[]
  visitas          Visita[]
  registrosAccesos RegistroAcceso[]

  @@index([privadaId])
  @@map("residencias")
}

// residencias_residentes: residente_id es char(8), NO auto_increment
model Residente {
  id                String   @id @map("residente_id") @db.Char(8)
  residenciaId      Int      @map("residencia_id")
  apePaterno        String   @default("") @map("ape_paterno") @db.VarChar(50)
  apeMaterno        String   @default("") @map("ape_materno") @db.VarChar(50)
  nombre            String   @default("") @db.VarChar(50)
  celular           String   @default("") @db.VarChar(14)
  email             String   @default("") @db.VarChar(100)
  reportarAcceso    Int      @default(0) @map("reportar_acceso") @db.TinyInt
  estatusId         Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId      Int      @default(0) @map("usuario_id")

  residencia        Residencia          @relation(fields: [residenciaId], references: [id])
  tarjetasAsignadas ResidenteTarjeta[]

  @@index([residenciaId])
  @@map("residencias_residentes")
}

// residencias_visitantes: visitante_id es char(8), NO auto_increment
model Visita {
  id                String   @id @map("visitante_id") @db.Char(8)
  residenciaId      Int      @map("residencia_id")
  apePaterno        String   @default("") @map("ape_paterno") @db.VarChar(50)
  apeMaterno        String   @default("") @map("ape_materno") @db.VarChar(50)
  nombre            String   @default("") @db.VarChar(50)
  telefono          String   @default("") @db.VarChar(14)
  celular           String   @default("") @db.VarChar(14)
  email             String   @default("") @db.VarChar(60)
  observaciones     String   @default("") @db.Text
  estatusId         Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId      Int      @default(0) @map("usuario_id")

  residencia Residencia @relation(fields: [residenciaId], references: [id])

  @@index([residenciaId])
  @@map("residencias_visitantes")
}

// ============================================================
// REGISTRO GENERAL (Solicitantes que no son residentes ni visitantes)
// ============================================================

model RegistroGeneral {
  id                String   @id @map("registro_general_id") @db.Char(8)
  apePaterno        String   @default("") @map("ape_paterno") @db.VarChar(50)
  apeMaterno        String   @default("") @map("ape_materno") @db.VarChar(50)
  nombre            String   @default("") @db.VarChar(50)
  telefono          String   @default("") @db.VarChar(14)
  celular           String   @default("") @db.VarChar(14)
  fechanac          String   @default("000000") @db.VarChar(30)
  email             String   @default("") @db.VarChar(100)
  observaciones     String   @default("") @db.Text
  estatusId         Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId      Int      @default(0) @map("usuario_id")

  @@map("registros_generales")
}

// ============================================================
// TARJETAS RFID
// ============================================================

model Tarjeta {
  id                Int      @id @default(autoincrement()) @map("tarjeta_id")
  fecha             DateTime @default(now()) @db.DateTime(0)
  lectura           String   @default("") @db.VarChar(20)
  numeroSerie       String   @default("") @map("numero_serie") @db.VarChar(20)
  tipoId            Int      @default(0) @map("tipo_id") @db.SmallInt
  estatusId         Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId      Int      @default(0) @map("usuario_id")

  @@map("tarjetas")
}

// residencias_residentes_tarjetas: estructura denormalizada con 5 slots de tarjeta
model ResidenteTarjeta {
  id                      Int      @id @default(autoincrement()) @map("asignacion_id")
  privada                 Int      @default(0)
  tarjetaId               String   @default("") @map("tarjeta_id") @db.VarChar(11)
  tarjetaId2              String   @default("") @map("tarjeta_id2") @db.VarChar(11)
  tarjetaId3              String   @default("") @map("tarjeta_id3") @db.VarChar(11)
  tarjetaId4              String   @default("") @map("tarjeta_id4") @db.VarChar(11)
  tarjetaId5              String   @default("") @map("tarjeta_id5") @db.VarChar(11)
  numeroSerie             String   @default("") @map("numero_serie") @db.VarChar(6)
  numeroSerie2            String   @default("") @map("numero_serie2") @db.VarChar(6)
  numeroSerie3            String   @default("") @map("numero_serie3") @db.VarChar(6)
  numeroSerie4            String   @default("") @map("numero_serie4") @db.VarChar(6)
  numeroSerie5            String   @default("") @map("numero_serie5") @db.VarChar(6)
  residenteId             String   @map("residente_id") @db.VarChar(100)
  compradorId             String   @default("") @map("comprador_id") @db.VarChar(100)
  mostrarNombreComprador  Int      @default(0) @map("mostrar_nombre_comprador") @db.TinyInt
  fecha                   DateTime? @db.Date
  fechaVencimiento        DateTime? @map("fecha_vencimiento") @db.Date
  lecturaTipoId           Int      @default(0) @map("lectura_tipo_id") @db.SmallInt
  lecturaEpc              String   @default("") @map("lectura_epc") @db.VarChar(20)
  folioContrato           String   @default("") @map("folio_contrato") @db.VarChar(10)
  precio                  Float    @default(0)
  descuento               Float    @default(0)
  IVA                     Float    @default(0)
  utilizoSeguro           Int      @default(0) @map("utilizo_seguro") @db.TinyInt
  utilizoSeguro2          Int      @default(0) @map("utilizo_seguro2") @db.TinyInt
  utilizoSeguro3          Int      @default(0) @map("utilizo_seguro3") @db.TinyInt
  utilizoSeguro4          Int      @default(0) @map("utilizo_seguro4") @db.TinyInt
  utilizoSeguro5          Int      @default(0) @map("utilizo_seguro5") @db.TinyInt
  concepto                String   @default("") @db.VarChar(100)
  interfonExtra           Int      @default(0) @map("interfon_extra")
  estatusId               Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion       DateTime? @map("fecha_modificacion") @db.Date
  tipoPago                Int      @default(0) @map("tipo_pago")
  usuarioModId            Int      @default(0) @map("usuario_id")
  observaciones           String   @default("") @db.VarChar(100)

  residente Residente @relation(fields: [residenteId], references: [id])

  @@index([residenteId])
  @@map("residencias_residentes_tarjetas")
}

// ============================================================
// REGISTRO DE ACCESOS (Módulo principal)
// ============================================================

model RegistroAcceso {
  id                Int      @id @default(autoincrement()) @map("registro_acceso_id")
  empleadoId        Int      @map("empleado_id")
  privadaId         Int      @map("privada_id")
  residenciaId      Int      @map("residencia_id")
  tipoGestionId     Int      @map("tipo_gestion_id") @db.TinyInt
  solicitanteId     String   @default("") @map("solicitante_id") @db.VarChar(8)
  observaciones     String   @default("") @db.Text
  ocr               String   @default("") @map("OCR") @db.Text
  duracion          DateTime @default(now()) @map("duracion") @db.Time(0)
  imagen            String   @default("") @db.VarChar(30)
  estatusId         Int      @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion DateTime @updatedAt @map("fecha_modificacion")
  usuarioId         Int      @map("usuario_id")

  // Relaciones
  empleado           Empleado           @relation("AccesoEmpleado", fields: [empleadoId], references: [id])
  privada            Privada            @relation(fields: [privadaId], references: [id])
  residencia         Residencia         @relation(fields: [residenciaId], references: [id])
  supervisionLlamada SupervisionLlamada?

  @@index([fechaModificacion])
  @@index([privadaId])
  @@index([empleadoId])
  @@index([residenciaId])
  @@map("registros_accesos")
}

// supervicion_llamadas (typo preservado de BD real): PK es registro_acceso_id (no autoincrement)
model SupervisionLlamada {
  registroAccesoId   Int      @id @map("registro_acceso_id")
  supervisorId       Int      @map("supervisor_id")
  fecha              DateTime @default(now()) @db.DateTime(0)
  saludo             Int      @default(0) @db.TinyInt
  identificoEmpresa  Int      @default(0) @map("identifico_empresa") @db.TinyInt
  identificoOperador Int      @default(0) @map("identifico_operador") @db.TinyInt
  amable             Int      @default(0) @db.TinyInt
  gracias            Int      @default(0) @db.TinyInt
  demanda            Int      @default(0) @db.TinyInt
  asunto             Int      @default(0) @db.TinyInt
  tiempoGestion      DateTime @default(now()) @map("tiempo_gestion") @db.Time(0)
  observaciones      String   @default("") @db.Text
  fechaModificacion  DateTime @updatedAt @map("fecha_modificacion")
  usuarioModId       Int      @default(0) @map("usuario_id") @db.TinyInt

  registroAcceso RegistroAcceso @relation(fields: [registroAccesoId], references: [id])

  @@map("supervicion_llamadas")
}

// ============================================================
// ORDENES DE SERVICIO
// ============================================================

model OrdenServicio {
  id                  Int       @id @default(autoincrement()) @map("orden_servicio_id")
  folio               String    @default("") @db.Char(8)
  fecha               DateTime? @db.Date
  empleadoId          Int       @map("empleado_id")
  privadaId           Int       @map("privada_id")
  tecnicoId           Int       @map("tecnico_id")
  cierreTecnicoId     Int       @default(0) @map("cierre_tecnico_id")
  cierreFecha         DateTime  @default(now()) @map("cierre_fecha") @db.DateTime(0)
  cierreComentario    String    @default("") @map("cierre_comentario") @db.Text
  fechaAsistio        DateTime  @default(now()) @map("fecha_asistio") @db.DateTime(0)
  tiempo              Int       @default(0) @db.SmallInt
  codigoServicioId    Int       @map("codigo_servicio_id")
  detalleServicio     String    @default("") @map("detalle_servicio") @db.Text
  diagnosticoId       Int       @default(0) @map("diagnostico_id")
  detalleDiagnostico  String    @default("") @map("detalle_diagnostico") @db.Text
  estatusId           Int       @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion   DateTime  @updatedAt @map("fecha_modificacion")
  usuarioModId        Int       @default(0) @map("usuario_id") @db.SmallInt

  empleado       Empleado       @relation("OrdenEmpleado", fields: [empleadoId], references: [id])
  privada        Privada        @relation(fields: [privadaId], references: [id])
  tecnico        Empleado       @relation("OrdenTecnico", fields: [tecnicoId], references: [id])
  cierreTecnico  Empleado?      @relation("OrdenCierreTecnico", fields: [cierreTecnicoId], references: [id])
  codigoServicio CodigoServicio @relation(fields: [codigoServicioId], references: [id])
  diagnostico    Diagnostico?   @relation(fields: [diagnosticoId], references: [id])
  seguimientos   OrdenServicioSeguimiento[]

  @@index([folio])
  @@index([fecha])
  @@index([empleadoId])
  @@index([privadaId])
  @@index([tecnicoId])
  @@index([codigoServicioId])
  @@index([diagnosticoId])
  @@index([cierreTecnicoId])
  @@map("ordenes_servicio")
}

model OrdenServicioSeguimiento {
  ordenServicioId Int      @map("orden_servicio_id")
  seguimientoId   Int      @map("seguimiento_id")
  comentario      String   @default("") @db.Text
  fecha           DateTime @default(now()) @db.DateTime(0)
  usuarioModId    Int      @default(0) @map("usuario_id")

  ordenServicio OrdenServicio @relation(fields: [ordenServicioId], references: [id], onDelete: Cascade)

  @@id([ordenServicioId, seguimientoId])
  @@index([ordenServicioId])
  @@map("ordenes_servicio_seguimiento")
}

// ============================================================
// GASTOS
// ============================================================

model Gasto {
  id               Int    @id @default(autoincrement()) @map("gasto_id")
  tipoGastoId      Int    @map("tipo_gasto") @db.TinyInt
  privadaId        Int    @map("privada_id")
  descripcionGasto String @default("") @map("descripcion_gasto") @db.VarChar(100)
  fechaPago        String @default("") @map("fecha_pago") @db.VarChar(100)
  comprobante      String @default("") @db.VarChar(50)
  total            Float  @default(0)
  tipoPago         Int    @default(0) @map("tipo_pago")
  fecha            String @default("") @db.VarChar(100)
  usuarioModId     Int    @default(0) @map("usuario_id")
  estatusId        Int    @default(1) @map("estatus_id")

  tipoGasto TipoGasto @relation(fields: [tipoGastoId], references: [id])
  privada   Privada   @relation(fields: [privadaId], references: [id])

  @@index([tipoGastoId])
  @@index([privadaId])
  @@map("gastos")
}

// ============================================================
// RECUPERACION PATRIMONIAL
// ============================================================

model RecuperacionPatrimonial {
  id                     Int       @id @default(autoincrement()) @map("recuperacion_patrimonial_id")
  folio                  String    @default("") @db.VarChar(10)
  fecha                  DateTime  @default(now()) @db.DateTime(0)
  empleadoId             Int       @default(0) @map("empleado_id")
  privadaId              Int       @default(0) @map("privada_id")
  ordenServicioId        Int       @default(0) @map("orden_servicio_id")
  relatoHechos           String    @default("") @map("relato_hechos") @db.Text
  responsableNombre      String    @default("") @map("responsable_nombre") @db.VarChar(80)
  responsableDomicilio   String    @default("") @map("responsable_domicilio") @db.Text
  responsableTelefono    String    @default("") @map("responsable_telefono") @db.VarChar(14)
  responsableCelular     String    @default("") @map("responsable_celular") @db.VarChar(14)
  responsableRelacion    String    @default("") @map("responsable_relacion") @db.VarChar(40)
  vehiculoPlacas         String    @default("") @map("vehiculo_placas") @db.VarChar(20)
  vehiculoModelo         String    @default("") @map("vehiculo_modelo") @db.VarChar(20)
  vehiculoColor          String    @default("") @map("vehiculo_color") @db.VarChar(20)
  vehiculoMarca          String    @default("") @map("vehiculo_marca") @db.VarChar(20)
  seguro                 Int       @default(0) @db.TinyInt
  seguroNombres          String    @default("") @map("seguro_nombres") @db.Text
  testigos               Int       @default(0) @db.TinyInt
  testigosNombres        String    @default("") @map("testigos_nombres") @db.Text
  videos                 Int       @default(0) @db.TinyInt
  videosDireccion        String    @default("") @map("videos_direccion") @db.Text
  avisoAdministrador     Int       @default(0) @map("aviso_administrador") @db.TinyInt
  avisoAdministradorFecha DateTime @default(now()) @map("aviso_administrador_fecha") @db.DateTime(0)
  observaciones          String    @default("") @db.Text
  estatusId              Int       @default(1) @map("estatus_id") @db.TinyInt
  fechaModificacion      DateTime  @updatedAt @map("fecha_modificacion")
  usuarioModId           Int       @default(0) @map("usuario_id")

  seguimientos RecuperacionPatrimonialSeguimiento[]

  @@map("recuperacion_patrimonial")
}

model RecuperacionPatrimonialSeguimiento {
  recuperacionId Int      @map("recuperacion_patrimonial_id")
  seguimientoId  Int      @map("seguimiento_id")
  comentario     String   @default("") @db.Text
  fecha          DateTime @default(now()) @db.DateTime(0)
  usuarioModId   Int      @default(0) @map("usuario_id")

  recuperacion RecuperacionPatrimonial @relation(fields: [recuperacionId], references: [id], onDelete: Cascade)

  @@id([recuperacionId, seguimientoId])
  @@index([recuperacionId])
  @@map("recuperacion_patrimonial_seguimiento")
}

// ============================================================
// CATALOGOS ADICIONALES
// ============================================================

model Material {
  id          Int     @id @default(autoincrement()) @map("material_id")
  codigo      String  @default("") @db.VarChar(50)
  descripcion String  @default("") @db.VarChar(200)
  costo       Decimal @default(0) @db.Decimal(10, 2)
  estatusId   Int     @default(1) @map("estatus_id") @db.TinyInt
  usuarioId   Int     @default(0) @map("usuario_id")

  @@map("materiales")
}
